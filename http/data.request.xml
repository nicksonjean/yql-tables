<?xml version="1.0" encoding="UTF-8"?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
    <meta>
        <author>Nickson Jeanmerson</author>
        <description>Envia (Post) e Recebe (Get) Dados de Sites e Web Service</description>
        <sampleQuery></sampleQuery>
        <documentationURL></documentationURL>
    </meta>
    <bindings>
        <select itemPath="" produces="XML">
            <urls>
                <url>{url}</url>
            </urls>
            <inputs>
                <key id="url" type="xs:string" required="true" paramType="variable"/>
                <key id="type" type="xs:string" required="false" default="get" paramType="variable"/>
                <key id="requestdata" type="xs:string" required="false" paramType="variable"/>
                <key id="xpath" type="xs:string" required="false" paramType="variable"/>
                <key id="headers" type="xs:string" required="false" paramType="variable"/>
            </inputs>
            <execute>
                <![CDATA[
                    if(headers) {
                        var _headers = headers.split(',');
                        var headerString = '';
                        for (i = 0; i < _headers.length; i++) {
                            headerString += "'" + _headers[i].trim().split(':')[0] + "'" + ',' + "'" + _headers[i].trim().split(':')[1] + "'" + ',';
                        }
                    }

                    y.log("header: " + headers);
                    y.log("headerString " + headerString);

                    var _request = y.rest(url);
                    if(type == 'post') {
                        if(headers) {
                            var _data = _request.header(headerString.substring(0,headerString.length - 1)).contentType("application/x-www-form-urlencoded").post(requestdata).response;
                        }
                        else {
                            var _data = _request.accept('text/html').contentType("application/x-www-form-urlencoded").post(requestdata).response;
                        }
                        if(xpath) {
                            var xdata = y.xpath(_data,xpath);
                            response.object = <postresult>{xdata}</postresult>;
                        }
                        else {
                            response.object = <postresult>{_data}</postresult>;
                        }
                    }
                    else {
                        if(headers) {
                            var _data = _request.header(headerString.substring(0,headerString.length - 1)).get(requestdata).response;
                        }
                        else {
                            var _data = _request.get(requestdata).response;
                        }
                        if(xpath) {
                            var xdata = y.xpath(_data,xpath);
                            response.object = <getresult>{xdata}</getresult>;
                        }
                        else {
                            response.object = <getresult>{_data}</getresult>;
                        }
                    }
                ]]>
            </execute>
        </select>
    </bindings>
</table>
